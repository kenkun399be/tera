<!DOCTYPE html>
<html>
<head>
<title>ゴミゲー</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background-color: black;
}

#gameCanvas {
  background-color: black;
  position: relative;
}

.player {
  position: absolute;
  width: 20px;
  height: 40px;
  background-color: white;
}

.obstacle {
  position: absolute;
  width: 20px;
  height: 40px;
  background-color: red;
}

.obstacle-huge { /* 大きな障害物のスタイル */
  position: absolute;
  width: 100px; /* 大きな障害物の幅 */
  height: 100px; /* 大きな障害物の高さ */
  background-color: yellow; /* 大きな障害物の色 */
}

.laser {
  position: absolute;
  width: 5px;
  height: 20px;
  background-color: blue;
  display: none;
}

.timer {
  position: absolute;
  top: 10px;
  right: 10px;
  color: white;
  font-size: 30px;
  display: none;
}

.score {
  position: absolute;
  top: 50px;
  right: 10px;
  color: white;
  font-size: 20px;
  display: none;
}

.high-score {
  position: absolute;
  top: 80px;
  right: 10px;
  color: white;
  font-size: 20px;
  display: none;
}

.difficulty-buttons {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.difficulty-button {
  background-color: black;
  color: white;
  padding: 20px 40px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
 
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.5), 0 0 10px rgba(255, 0, 255, 0.5);
}
</style>
</head>
<body>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<div class="timer">タイム:</div>
<div class="score">現在のスコア: </div>
<div class="high-score">最高記録: </div>
<div class="difficulty-buttons">
  <button class="difficulty-button" id="easyButton">EASY</button>
  <button class="difficulty-button" id="hardButton">HARD</button>
  <button class="difficulty-button" id="oniButton">鬼畜</button>
</div>

<div class="laser" id="laser1"></div>
<div class="laser" id="laser2"></div>
<div class="laser" id="laser3"></div>
<div class="laser" id="laser4"></div>
<div class="laser" id="laser5"></div>
<div class="laser" id="laser6"></div>
<div class="laser" id="laser7"></div>
<div class="laser" id="laser8"></div>
<div class="laser" id="laser9"></div>
<div class="laser" id="laser10"></div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const timerElement = document.querySelector('.timer');
const scoreElement = document.querySelector('.score');
const highScoreElement = document.querySelector('.high-score');
const easyButton = document.getElementById('easyButton');
const hardButton = document.getElementById('hardButton');
const oniButton = document.getElementById('oniButton');
const laserElements = [
  document.getElementById('laser1'),
  document.getElementById('laser2'),
  document.getElementById('laser3'),
  document.getElementById('laser4'),
  document.getElementById('laser5'),
  document.getElementById('laser6'),
  document.getElementById('laser7'),
  document.getElementById('laser8'),
  document.getElementById('laser9'),
  document.getElementById('laser10')
];

let player = {
  x: 50,
  y: canvas.height / 2,
  radius: 10,
  speed: 5
};

let obstacleWidth = 20;
let obstacleHeight = 20;
const obstacleColor = 'red';

const averageObstacleSpeed = 2;
let obstacles = [];

let isUpPressed = false;
let isDownPressed = false;

let startTime = null;

let isGameOver = false;

let gameOverFontSize = 10;
let gameOverScale = 1;

let score = 0;

let avoidedObstacles = 0;

let difficulty = 'easy';

const easyObstacleInterval = 1000;
const hardObstacleInterval = 350;
const oniObstacleInterval = 100; // 鬼畜モードの障害物出現間隔

let obstacleTimer = null;

let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;

let lasers = []; // レーザーの配列
const maxLasers = 10; // 最大レーザー数
const laserSpeed = 10;

easyButton.addEventListener('click', () => {
  difficulty = 'easy';
  startGame();
});

hardButton.addEventListener('click', () => {
  difficulty = 'hard';
  startGame();
});

oniButton.addEventListener('click', () => {
  difficulty = 'oni';
  startGame();
});

function startGame() {
  easyButton.style.display = 'none';
  hardButton.style.display = 'none';
  oniButton.style.display = 'none';

  timerElement.style.display = 'block'; 
  scoreElement.style.display = 'block';
  highScoreElement.style.display = 'block';

  highScoreElement.textContent = `最高記録: ${highScore}`;

  obstacleTimer = setInterval(() => {
    generateObstacle();
  }, difficulty === 'easy' ? easyObstacleInterval : difficulty === 'hard' ? hardObstacleInterval : oniObstacleInterval);

  gameLoop();
}

function generateObstacle() {
  if (difficulty === 'hard' || difficulty === 'oni') {
    obstacleWidth = 30; // HARDと同じ大きさ
    obstacleHeight = 30;

    if (difficulty === 'oni' && Math.random() < 0.1) { // 鬼畜モードのみ10%の確率で巨大障害物
      obstacleWidth = 100;
      obstacleHeight = 100;
      obstacleColor = 'yellow'; // 巨大障害物の色は黄色
    }
  } else {
    obstacleWidth = 20;
    obstacleHeight = 20;
  }

  let newObstacleX = canvas.width;
  let newObstacleY = Math.random() * (canvas.height - obstacleHeight);
  while (
    newObstacleX < player.x + player.radius &&
    newObstacleX + obstacleWidth > player.x - player.radius &&
    newObstacleY < player.y + player.radius &&
    newObstacleY + obstacleHeight > player.y - player.radius
  ) {
    newObstacleX = canvas.width;
    newObstacleY = Math.random() * (canvas.height - obstacleHeight);
  }
  obstacles.push({
    x: newObstacleX,
    y: newObstacleY,
    speed: averageObstacleSpeed + (Math.random() * 0.2 - 0.1),
    rotation: 0,
    rotationSpeed: Math.random() * 0.05 + 0.02,
    verticalSpeed: Math.random() * 2 - 1,
    width: obstacleWidth,
    height: obstacleHeight,
    color: obstacleColor
  });
}

function gameLoop(timestamp) {
  if (!startTime) {
    startTime = timestamp;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (isUpPressed && player.y - player.radius > 0) {
    player.y -= player.speed;
  } else if (isDownPressed && player.y + player.radius < canvas.height) {
    player.y += player.speed;
  }

  // レーザーの更新
  lasers.forEach((laser, index) => {
    laser.x += laserSpeed;

    // レーザー要素の更新
    if (index < laserElements.length) {
      laserElements[index].style.left = laser.x + 'px';
      laserElements[index].style.top = laser.y + 'px';
      laserElements[index].style.display = 'block';
    }

    // レーザーが画面外に出たら削除
    if (laser.x > canvas.width) {
      lasers.splice(index, 1);
    }

    // レーザーと障害物の衝突判定
    obstacles.forEach((obstacle, obstacleIndex) => {
      if (
        laser.x < obstacle.x + obstacle.width &&
        laser.x + 5 > obstacle.x &&
        laser.y < obstacle.y + obstacle.height &&
        laser.y + 20 > obstacle.y
      ) {
        // 衝突したら障害物を消す
        obstacles.splice(obstacleIndex, 1);
        avoidedObstacles++;
        lasers.splice(index, 1); // 衝突したレーザーも削除
      }
    });
  });

  obstacles.forEach(obstacle => {
    let elapsedTime = timestamp - startTime;
    let obstacleSpeed = obstacle.speed * Math.pow(elapsedTime / 1000, 0.1); // 速度を秒単位で計算
    obstacle.x -= obstacleSpeed; 

    if (difficulty === 'hard' || difficulty === 'oni') {
      obstacle.y += obstacle.verticalSpeed;
      if (obstacle.y < 0 || obstacle.y + obstacle.height > canvas.height) {
        obstacle.verticalSpeed *= -1;
      }
    }

    if (obstacle.x < -obstacle.width) {
      obstacles.splice(obstacles.indexOf(obstacle), 1);
      avoidedObstacles++;
    }
    obstacle.rotation += obstacle.rotationSpeed;
  });

  obstacles.forEach(obstacle => {
    if (
      player.x - player.radius < obstacle.x + obstacle.width &&
      player.x + player.radius > obstacle.x &&
      player.y - player.radius < obstacle.y + obstacle.height &&
      player.y + player.radius > obstacle.y
    ) {
      isGameOver = true;
      cancelAnimationFrame(gameLoop.animationFrame);
      clearInterval(obstacleTimer);
    }
  });

  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, 2 * Math.PI);
  ctx.fillStyle = 'black';
  ctx.fill();
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius - 1, 0, 2 * Math.PI);
  ctx.strokeStyle = 'white';
  ctx.lineWidth = 2;
  ctx.stroke();

  obstacles.forEach(obstacle => {
    ctx.save();
    ctx.translate(obstacle.x + obstacle.width / 2, obstacle.y + obstacle.height / 2);
    ctx.rotate(obstacle.rotation);
    ctx.fillStyle = obstacle.color;
   
    ctx.beginPath();
    const sideLength = obstacle.width * Math.sqrt(3) / 2;
    const height = sideLength * Math.sqrt(3) / 2;
    ctx.moveTo(0, -height);
    ctx.lineTo(-sideLength / 2, height / 2);
    ctx.lineTo(sideLength / 2, height / 2);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  });

  const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
  gradient.addColorStop(0, 'rgba(0, 255, 255, 1)');
  gradient.addColorStop(1, 'rgba(255, 0, 255, 1)');
  ctx.strokeStyle = gradient;
  ctx.lineWidth = 3;
  ctx.strokeRect(0, 0, canvas.width, canvas.height);

  if (!isGameOver) {
    let elapsedTime = (timestamp - startTime) / 1000;
    let minutes = Math.floor(elapsedTime / 60);
    let seconds = Math.floor(elapsedTime % 60);

    timerElement.textContent = `タイム: ${minutes}:${seconds.toString().padStart(2, '0')}`;

    score = avoidedObstacles * 10 + Math.floor((timestamp - startTime) / 1000);
    scoreElement.textContent = `現在のスコア: ${score}`;
  }

  if (isGameOver) {
   
    gameOverScale += 0.01;
    gameOverFontSize = gameOverScale * 50;

    ctx.font = `${gameOverFontSize}px Arial`;
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 30);

    score = avoidedObstacles * 10 + Math.floor((timestamp - startTime) / 1000);

    ctx.font = `${gameOverFontSize * 0.7}px Arial`;
    ctx.fillStyle = 'white';
    ctx.textAlign = 'center';
    ctx.fillText(`SCORE: ${score}`, canvas.width / 2, canvas.height / 2 + 30);

    if (score > highScore) {
      highScore = score;
      localStorage.setItem('highScore', highScore);
    }
    highScoreElement.textContent = `最高記録: ${highScore}`;

    setTimeout(() => {
      location.reload(); // 3秒後にページを再読み込み
    }, 3000);

  } else {
    gameLoop.animationFrame = requestAnimationFrame(gameLoop);
  }
}

window.addEventListener('keydown', (event) => {
  if (event.key === 'w' || event.key === 'ArrowUp') {
    isUpPressed = true;
  } else if (event.key === 's' || event.key === 'ArrowDown') {
    isDownPressed = true;
  } else if (event.key === ' ' && difficulty === 'oni' && lasers.length < maxLasers) { // 鬼畜モードでスペースキーが押され、レーザー数が最大数未満の場合
    if (Math.random() < 0.1) { // 10%の確率で全方向レーザー
      const angleStep = 5; // レーザーの角度間隔
      for (let i = 0; i < 360; i += angleStep) {
        const angle = i * Math.PI / 180;
        const laserX = player.x + Math.cos(angle) * 10;
        const laserY = player.y + Math.sin(angle) * 10;
        lasers.push({
          x: laserX,
          y: laserY
        });
      }
    } else { // 通常のレーザー
      lasers.push({
        x: player.x,
        y: player.y - 10 // プレイヤーの上からレーザーを発射
      });
    }
  }
});

window.addEventListener('keyup', (event) => {
  if (event.key === 'w' || event.key === 'ArrowUp') {
    isUpPressed = false;
  } else if (event.key === 's' || event.key === 'ArrowDown') {
    isDownPressed = false;
  }
});
</script>
</body>
</html>
